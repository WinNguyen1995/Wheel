<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Wheel</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- <link rel="stylesheet" href="css/typo/typo.css" /> -->
    <link rel="stylesheet" href="/styles.css" />
    <!-- jQuery library -->
    <!-- <script
      src="https://code.jquery.com/jquery-3.6.0.js"
      integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
      crossorigin="anonymous"
    ></script> -->
  </head>

   <body class="bg">
    <img src="Home.jpg" altstyle="width:1000ps;max-height:1000px; margin-left: 35%;">
    <div>
      <!-- <button type="submit" id="button1">CHƠI NGAY</button> -->    
   <!-- ///////////////////////////////   Root   ////////////////////////////////////////////    -->
      <section id="luckywheel" class="hc-luckywheel"> 
        <div class="hc-luckywheel-container">
           <canvas class="hc-luckywheel-canvas" width="500px" height="500px"
            >Vòng Xoay May Mắn</canvas>
        </div> 
        <a class="hc-luckywheel-btn" id="button1">Kết quả</a> 
       </section> 
     </div>
  

    <script>
      // var screenWidth = screen.width;
      // var screenHeight = screen.height;
      // var origin_top = 226;
      // var origin_left = 45;
      // var origin_width = 375;
      // var origin_height = 812;
      // var new_width = 0;
      // var new_height = 0;

      // var canvas = document.getElementById("responsive-canvas");
      // var heightRatio = 1.0;
      // canvas.height = canvas.width * heightRatio;
      // ////////////////////////////////
      // var ctx = canvas.getContext("2d");
      // var radius = canvas.height / 2;
      // ctx.translate(radius, radius);
      // radius = radius * 0.95;
      // drawCircle();

      // function drawCircle() {
      //   drawFace(ctx, radius);
      // }

      // function getPosition() {
      //   new_width = (screenWidth * origin_top) / origin_width;
      //   new_height = (screenWidth * origin_top) / origin_height;
      //   $("#responsive-canvas").css({
      //     top: new_width + "px",
      //     left: new_height + "px",
      //   });
      // }
      // $document.ready(getPosition());

      // function drawFace(ctx, radius) {
      //   var grad;
      //   ctx.beginPath();
      //   ctx.arc(0, 0, radius, 0, 2 * Math.PI);
      //   ctx.fillStyle = "white";
      //   ctx.fill();
      //   grad = ctx.createRadialGradient(
      //     0,
      //     0,
      //     radius * 0.95,
      //     0,
      //     0,
      //     radius * 1.05
      //   );
      //   grad.addColorStop(0, "tomato");
      //   grad.addColorStop(0.5, "white");
      //   grad.addColorStop(1, "tomato");
      //   ctx.strokeStyle = grad;
      //   ctx.lineWidth = radius * 0.1;
      //   ctx.stroke();
      //   ctx.beginPath();
      //   ctx.arc(0, 0, radius * 0.2, 0, 2 * Math.PI);
      //   ctx.fillStyle = "#ff6456";
      //   ctx.fill();
      // }
    </script>





    <script>
      var isPercentage = true;
      var prizes = [
        {
          text: "Iphone",
          number: 1, // quanlity
          percentpage: 0.02, // 2%
        },
        {
          text: "Thêm lượt quay",
          number: 1,
          percentpage: 0.02, // 2%
        },
        {
          text: "Thẻ cào 50k",
          number: 1,
          percentpage: 0.02, // 2%
        },
        {
          text: "Chúc may mắn",
          number: 1,
          percentpage: 0.45, // 45%
        },
        {
          text: "Thẻ cào 100k",
          number: 1,
          percentpage: 0.02, // 2%
        },
        {
          text: "Chúc may mắn",
          percentpage: 0.45, // 45%
        },
      ];

          document.addEventListener(
          "DOMContentLoaded",
          function() {
            hcLuckywheel.init({
              id: "luckywheel",
              config: function(callback) {
                callback &&
                  callback(prizes);
              },
              mode : "both",
              getPrize: function(callback) {
                var rand = randomIndex(prizes);
                var chances = rand;
                callback && callback([rand, chances]);
              },
              gotBack: function(data) {
                if(data == null){
                  Swal.fire(
                    'Chương trình kết thúc',
                    'Đã hết phần thưởng',
                    'error'
                  )
                } else if (data == 'Chúc bạn may mắn lần sau'){
                  Swal.fire(
                    'Bạn không trúng thưởng',
                    data,
                    'error'
                  )
                } else{
                  alert(data);
                }
              }
            });
          },
          false
        );

      function randomIndex(prizes) {
        if (isPercentage) {
          var counter = 1;
          for (let i = 0; i < prizes.length; i++) {
            if (prizes[i].number == 0) {
              counter++;
            }
          }
          if (counter == prizes.length) {
            return null;
          }
          let rand = Math.random();
          let prizeIndex = null;
          // console.log(rand);
          switch (true) {
            case rand < prizes[5].percentpage:
              prizeIndex = 5;
              break;
            case rand < prizes[5].percentpage + 
              prizes[4].percentpage:
              prizeIndex = 4;
              break;
            case rand <
              prizes[5].percentpage +
                prizes[4].percentpage +
                prizes[3].percentpage:
              prizeIndex = 3;
              break;
            case rand <
              prizes[5].percentpage +
                prizes[4].percentpage +
                prizes[3].percentpage +
                prizes[2].percentpage:
              prizeIndex = 2;
              break;
            case rand <
              prizes[5].percentpage +
                prizes[4].percentpage +
                prizes[3].percentpage +
                prizes[2].percentpage +
                prizes[1].percentpage:
              prizeIndex = 1;
              break;
            case rand <
              prizes[5].percentpage +
                prizes[4].percentpage +
                prizes[3].percentpage +
                prizes[2].percentpage +
                prizes[1].percentpage +
                prizes[0].percentpage:
              prizeIndex = 0;
              break;
          }
          if (prizes[prizeIndex].number != 0) {
            prizes[prizeIndex].number = prizes[prizeIndex].number - 1;
            return prizeIndex;
          } else {
            return randomIndex(prizes);
          }
        } else {
          var counter = 0;
          for (let i = 0; i < prizes.length; i++) {
            if (prizes[i].number == 0) {
              counter++;
            }
          }
          if (counter == prizes.length) {
            return null;
          }
          var rand = (Math.random() * prizes.length) >>> 0;
          if (prizes[rand].number != 0) {
            prizes[rand].number = prizes[rand].number - 1;
            return rand;
          } else {
            return randomIndex(prizes);
          }
        }
      }
    </script>
    <script src="canvas-luckywheel.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
  </body>
</html>
